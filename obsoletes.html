<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Graveyard &#8212; My Retrogaming Setup 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=1bc0af66" />
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Products Used" href="products.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="graveyard">
<span id="obsoletes"></span><h1>Graveyard<a class="headerlink" href="#graveyard" title="Link to this heading">¶</a></h1>
<p>This file contains a list of previous implementations that have been replaced with newer ones.</p>
<section id="cec-through-raspberry-pi">
<span id="cec-rpi"></span><h2>CEC through Raspberry PI<a class="headerlink" href="#cec-through-raspberry-pi" title="Link to this heading">¶</a></h2>
<p><em>I no longer use this method because Home Assistant was regularly losing connection with the Raspberry PI and the only way to resolve it was to restart regularly Homeassistant. See</em> <a class="reference internal" href="cec.html#cec"><span class="std std-ref">latest CEC implementation</span></a> <em>.</em></p>
<p>CEC is a feature of HDMI that allows individual CEC-enabled devices to control each other without user intervention.</p>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h3>
<p>I use CEC protocol control my TV from Home Assistant. Ex: Turn on/off TV, change input source, and control volume.</p>
<div class="graphviz"><object data="_images/graphviz-f7dbad693e103e3869f97c496f0d86a9085c8c75.svg" type="image/svg+xml" class="graphviz">
<p class="warning">// https://stackoverflow.com/a/59363959/2115513
digraph SEQ_DIAGRAM {
    graph [overlap = true, splines = line, nodesep = 1.0, ordering = out];
    edge [arrowhead = none];
    node [shape = none, width = 0, height = 0, label = &quot;&quot;];

    {
        rank = same;
        node [shape = rectangle, height = 0.7, width = 2];
        homeassistant [label = &quot;Home Assistant&quot;];
        cec [label = &quot;cec proxy (raspberry pi)&quot;];
        tv [label = &quot;TV&quot;];
    }
    // Draw vertical lines
    {
        edge [style = dashed, weight = 6];
        homeassistant -&gt; a1 -&gt; a2 -&gt; a3;
        a3 -&gt; a5;
    }
    {
        edge [style = dashed, weight = 6];
        cec -&gt; b1
        b1 -&gt; b2 [penwidth = 5, style = solid];
        b2 -&gt; b3 -&gt; b4 -&gt; b5;
    }
    {
        edge [style = dashed, weight = 6];
        tv -&gt; c1;
        c1 -&gt; c2;
        c2 -&gt; c3 [penwidth = 5, style = solid];
        c3 -&gt; c4 -&gt; c5;
    }
    { rank = same; a1 -&gt; b1 [label = &quot;send message via WIFI to proxy\nEx: 1f:82:10:00&quot;, arrowhead = normal]; }
    { rank = same; b2 -&gt; c2 [label =&quot;relay message to TV through HDMI cable\nEx: 1f:82:10:00&quot;, arrowhead = normal]; }
}</p></object></div>
</section>
<section id="proxy-configuration">
<h3>Proxy configuration<a class="headerlink" href="#proxy-configuration" title="Link to this heading">¶</a></h3>
<section id="setup-service">
<h4>Setup service<a class="headerlink" href="#setup-service" title="Link to this heading">¶</a></h4>
<p>Compile/Install <a class="reference external" href="https://github.com/Pulse-Eight/libcec">libcec</a></p>
<p>Install <a class="reference external" href="https://pypi.org/project/pyCEC/">pyCEC</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3<span class="w"> </span>install<span class="w"> </span>pyCEC
</pre></div>
</div>
<p>Configure a service for pyCEC:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">Unit</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">Description=PyCEC</span>
<span class="l l-Scalar l-Scalar-Plain">Documentation=</span>
<span class="l l-Scalar l-Scalar-Plain">After=network.target</span>

<span class="l l-Scalar l-Scalar-Plain">[Service]</span>
<span class="l l-Scalar l-Scalar-Plain">Type=simple</span>
<span class="l l-Scalar l-Scalar-Plain">User=retro</span>
<span class="l l-Scalar l-Scalar-Plain">ExecStart=/usr/bin/python3 -m pycec</span>
<span class="l l-Scalar l-Scalar-Plain">Restart=always</span>
<span class="l l-Scalar l-Scalar-Plain">#RuntimeMaxSec=1d</span>
<span class="l l-Scalar l-Scalar-Plain">#MemoryHigh=50M</span>
<span class="l l-Scalar l-Scalar-Plain">MemoryMax=60M</span>
<span class="l l-Scalar l-Scalar-Plain">MemorySwapMax=0</span>

<span class="l l-Scalar l-Scalar-Plain">[Install]</span>
<span class="l l-Scalar l-Scalar-Plain">WantedBy=multi-user.target</span>
</pre></div>
</div>
<p>It appears to have a memory leak and I made sure it kills itself when it gets to 60M of memory.</p>
</section>
</section>
<section id="home-assistant">
<h3>Home Assistant<a class="headerlink" href="#home-assistant" title="Link to this heading">¶</a></h3>
<section id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h4>
<p><a class="reference external" href="https://www.home-assistant.io/integrations/hdmi_cec/">Documentation</a></p>
<p>create a file <code class="docutils literal notranslate"><span class="pre">hdmi_cec.yaml</span></code> and add the hostname/ip of the cec proxy:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">retro-controller.local</span><span class="w"> </span><span class="c1"># this the hostname of my raspberry pi</span>
</pre></div>
</div>
<p>in <code class="docutils literal notranslate"><span class="pre">configuration.yaml</span></code> add:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hdmi_cec</span><span class="p">:</span><span class="w"> </span><span class="kt">!include</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdmi_cec.yaml</span>
</pre></div>
</div>
</section>
<section id="automations">
<h4>Automations<a class="headerlink" href="#automations" title="Link to this heading">¶</a></h4>
<p>I used <a class="reference external" href="https://cec-o-matic.com/">CEC-O-Matic</a> to determine the messages for my TV.</p>
<table class="docutils align-default" id="id8">
<caption><span class="caption-text">CEC messages for my TV</span><a class="headerlink" href="#id8" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Action</p></th>
<th class="head"><p>Message</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Power on</p></td>
<td><p>10:04</p></td>
</tr>
<tr class="row-odd"><td><p>Standby</p></td>
<td><p>10:36</p></td>
</tr>
<tr class="row-even"><td><p>Change source 1</p></td>
<td><p>1f:82:10:00</p></td>
</tr>
<tr class="row-odd"><td><p>Change source 2</p></td>
<td><p>1f:82:20:00</p></td>
</tr>
<tr class="row-even"><td><p>Change source 3</p></td>
<td><p>1f:82:30:00</p></td>
</tr>
<tr class="row-odd"><td><p>Volume up</p></td>
<td><p>10:44:41:00</p></td>
</tr>
<tr class="row-even"><td><p>Volume down</p></td>
<td><p>10:44:42:00</p></td>
</tr>
</tbody>
</table>
<p>This is an example home assistant automation to switch to hdmi 1:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hdmi_cec.send_command</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">raw</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1f:82:10:00</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="infrared-through-arduino">
<h2>Infrared through Arduino<a class="headerlink" href="#infrared-through-arduino" title="Link to this heading">¶</a></h2>
<p><em>I no longer use this method because Home Assistant was regularly losing connection with the Raspberry PI and the only way to resolve it was to restart regularly Homeassistant. See</em> <a class="reference internal" href="infrared.html#infrared"><span class="std std-ref">latest infrared implementation</span></a> <em>.</em></p>
<section id="id1">
<h3>Overview<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>I use Infrared signals to:</p>
<ul class="simple">
<li><p>change profile of the <a class="reference internal" href="products.html#retrotink-4k"><span class="std std-ref">Retrotink4K</span></a></p></li>
<li><p>change the input of the <a class="reference internal" href="products.html#hdmi-switch"><span class="std std-ref">HDMI switch</span></a></p></li>
</ul>
<p>This is how the whole process looks like:</p>
<div class="graphviz"><object data="_images/graphviz-bfe170fd661a61731f9963b1f2f65a5e09878b9c.svg" type="image/svg+xml" class="graphviz">
<p class="warning">// https://stackoverflow.com/a/59363959/2115513
digraph SEQ_DIAGRAM {
    graph [overlap=true, splines=line, nodesep=1.0, ordering=out];
    edge [arrowhead=none];
    node [shape=none, width=0, height=0, label=&quot;&quot;];

    {
        rank=same;
        node[shape=rectangle, height=0.7, width=2];
        mqtt[label=&quot;MQTT Broker (Home Assistant)&quot;];
        mqtt2nec[label=&quot;mqtt2nec (raspberry pi)&quot;];
        arduino[label=&quot;infrared-nec (arduino)&quot;];
        device[label=&quot;device&quot;];
    }
    // Draw vertical lines
    {
        edge [style=dashed, weight=6];
        mqtt -&gt; a1 -&gt; a2 -&gt; a3;
        a3 -&gt; a5;
    }
    {
        edge [style=dashed, weight=6];
        mqtt2nec -&gt; b1
        b1 -&gt; b2 [penwidth=5, style=solid];
        b2 -&gt; b3 -&gt; b4 -&gt; b5 ;
    }
    {
        edge [style=dashed, weight=6];
        arduino -&gt; c1;
        c1-&gt; c2;
        c2 -&gt; c3 [penwidth=5, style=solid];
        c3 -&gt; c4 -&gt; c5;
    }
    {
        edge [style=dashed, weight=6];
        device -&gt; d1 -&gt; d2 -&gt; d3;
        d3 -&gt; d4 [penwidth=5, style=solid];
        d4 -&gt; d5;
    }
    { rank=same; a1 -&gt; b1 [label=&quot;publish to topic \&quot;nec/tx\&quot;\nEx: {\&quot;codes\&quot;: [\&quot;TINK4K\&quot;, \&quot;TINK4K_1\&quot;]}&quot;, arrowhead=normal]; }
    { rank=same; b2 -&gt; c2 [label=&quot;write to serial port\nEx: \&quot;73;11\&quot;&quot;, arrowhead=normal]; }
    { rank=same; c3 -&gt; d3 [label=&quot;send infrared nec signal\n Ex: pew pew pew&quot;, arrowhead=normal]; }
}</p></object></div>
<p>This is how the whole setup looks like:</p>
<figure class="align-default" id="id9">
<img alt="Arduino with raspberry pi" src="_images/arduino.jpg" />
<figcaption>
<p><span class="caption-text">This image:
1. Raspberry pi Zero 2W – 2. USB Hub – 3. Arduino Nano Every with board. There’s one cable going to the Retrotink4K and another one going to the HDMI switch.</span><a class="headerlink" href="#id9" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id10">
<img alt="Keypad" src="_images/keypad.jpg" />
<figcaption>
<p><span class="caption-text">This image: an IR Led just above the keypad pointing at the Retrotink4K.</span><a class="headerlink" href="#id10" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="home-assistant-mqtt">
<h3>Home Assistant MQTT<a class="headerlink" href="#home-assistant-mqtt" title="Link to this heading">¶</a></h3>
<section id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h4>
<p>Setup <a class="reference internal" href="homeassistant.html#homeassistant-mqtt"><span class="std std-ref">Home Assistant’s MQTT Broker</span></a>.</p>
</section>
<section id="automation">
<h4>Automation<a class="headerlink" href="#automation" title="Link to this heading">¶</a></h4>
<p>Create an automation to send the nec codes to <a class="reference internal" href="#mqtt-to-nec-obsolete"><span class="std std-ref">mqtt2nec</span></a>.</p>
<p>The codes match <a class="reference external" href="https://github.com/jrobichaud/mqtt2nec/blob/main/config.csv">mqtt2nec’s config.csv</a>. You can also send codes as hex strings.</p>
<p>The first value is common for the device and the next ones are the actual code you want to send.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mqtt.publish</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nec/tx</span>
<span class="w">  </span><span class="nt">payload</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{\&quot;codes\&quot;:</span><span class="nv">  </span><span class="s">[</span><span class="nv">  </span><span class="s">\&quot;TINK4K\&quot;,</span><span class="nv"> </span><span class="s">\&quot;TINK4K_1\&quot;</span><span class="nv"> </span><span class="s">]}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="mqtt2nec">
<span id="mqtt-to-nec-obsolete"></span><h3>mqtt2nec<a class="headerlink" href="#mqtt2nec" title="Link to this heading">¶</a></h3>
<p>Python program interfacing Home assistant with the arduino. It is installed on the Raspberry pi and runs as a service.</p>
<p><a class="reference external" href="https://github.com/jrobichaud/mqtt2nec">sources</a></p>
<section id="installing-the-program">
<h4>Installing the program<a class="headerlink" href="#installing-the-program" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:jrobichaud/mqtt2nec.git
<span class="nb">cd</span><span class="w"> </span>mqtt2nec
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</section>
<section id="running-the-program">
<h4>Running the program<a class="headerlink" href="#running-the-program" title="Link to this heading">¶</a></h4>
<p>Make sure to change the arguments to match your mqtt broker configuration.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;mqtt2nec&quot;</span><span class="w"> </span><span class="s2">&quot;&lt;home assistant url&gt;&quot;</span><span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;&lt;mqtt user&gt;&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;&lt;mqtt password&gt;&quot;</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;./config.csv&quot;</span>
</pre></div>
</div>
</section>
<section id="service-configuration">
<h4>Service configuration<a class="headerlink" href="#service-configuration" title="Link to this heading">¶</a></h4>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">mqtt2nec</span>
<span class="na">Documentation</span><span class="o">=</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">User</span><span class="o">=</span><span class="s">retro</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/python3 -m &quot;mqtt2nec&quot; &quot;&lt;home assistant url&gt;&quot; -u &quot;&lt;mqtt user&gt;&quot; -p &quot;&lt;mqtt password&gt;&quot; -a &quot;/home/retro/mqtt2nec/config.csv&quot;</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">MemorySwapMax</span><span class="o">=</span><span class="s">0</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
</section>
</section>
<section id="arduino">
<h3>Arduino<a class="headerlink" href="#arduino" title="Link to this heading">¶</a></h3>
<p>I used this kit to prototype: <a class="reference external" href="https://www.canakit.com/arduino-starter-kit.html">Basic Kit for Arduino</a></p>
<p>I use the <a class="reference external" href="https://store-usa.arduino.cc/products/arduino-nano-every">Arduino Nano Every</a> on my setup.</p>
</section>
</section>
<section id="keypad-v1">
<span id="id2"></span><h2>Keypad v1<a class="headerlink" href="#keypad-v1" title="Link to this heading">¶</a></h2>
<img alt="Keypad" class="align-center" src="_images/keypad.jpg" />
<p>Its a 3d printed keypad with 16 keys I bought from <a class="reference external" href="https://www.etsy.com/ca/listing/1031708108/zmk-16-hotswap-mechanical-macropad">Etsy</a>.</p>
<section id="id3">
<h3>Overview<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<div class="graphviz"><object data="_images/graphviz-d18a4109ceff64bf832af9f39616ddeeb41f3323.svg" type="image/svg+xml" class="graphviz">
<p class="warning">// https://stackoverflow.com/a/59363959/2115513
digraph SEQ_DIAGRAM {
    graph [overlap = true, splines = line, nodesep = 1.0, ordering = out];
    edge [arrowhead = none];
    node [shape = none, width = 0, height = 0, label = &quot;&quot;];

    {
        rank = same;
        node [shape = rectangle, height = 0.7, width = 2];
        keypad [label = &quot;Keypad&quot;];
        raspberry_pi [label = &quot;keypad2mqtt (raspberry pi)&quot;];
        homeassistant [label = &quot;MQTT Broker (Home Assistant)&quot;];
    }
    // Draw vertical lines
    {
        edge [style = dashed, weight = 6];
        keypad -&gt; a1 -&gt; a2 -&gt; a3;
        a3 -&gt; a5;
    }
    {
        edge [style = dashed, weight = 6];
        raspberry_pi -&gt; b1
        b1 -&gt; b2 [penwidth = 5, style = solid];
        b2 -&gt; b3 -&gt; b4 -&gt; b5;
    }
    {
        edge [style = dashed, weight = 6];
        homeassistant -&gt; c1;
        c1 -&gt; c2;
        c2 -&gt; c3 [penwidth = 5, style = solid];
        c3 -&gt; c4 -&gt; c5;
    }
    { rank = same; a1 -&gt; b1 [label = &quot;send keydown event through USB&quot;, arrowhead = normal]; }
    { rank = same; b2 -&gt; c2 [label =&quot;publish to topic \&quot;keypad/F1\&quot; (to F16)&quot;, arrowhead = normal]; }
}</p></object></div>
</section>
<section id="keypad">
<span id="keypad-to-mqtt"></span><h3>Keypad<a class="headerlink" href="#keypad" title="Link to this heading">¶</a></h3>
<p>I mapped the keys from F1 to F16 using <a class="reference external" href="https://qmk.fm/">QMK</a> or <a class="reference external" href="https://get.vial.today/">Vial</a>… I can’t remember which one I used.</p>
<p>I used a P-touch label maker to label the keys.</p>
<p>The keypad is plugged to the raspberry pi.</p>
<p>The red X button will:</p>
<ul class="simple">
<li><p>power off all the <a class="reference internal" href="power.html#smart-plugs"><span class="std std-ref">Smart Plugs</span></a> except the one for the TV I keep always active;</p></li>
<li><p>send <a class="reference internal" href="cec.html#cec"><span class="std std-ref">CEC</span></a> message to turn off the TV;</p></li>
<li><p>stop the streaming on the <a class="reference internal" href="cast.html#cast"><span class="std std-ref">Chromecasts</span></a>;</p></li>
<li><p>close the light;</p></li>
<li><p>(I still manage the power of my consoles manually, however the PS5 will detect via <a class="reference internal" href="cec.html#cec"><span class="std std-ref">CEC</span></a> the TV is turned off so it will go to sleep automatically).</p></li>
</ul>
</section>
<section id="keypad2mqtt">
<h3>keypad2mqtt<a class="headerlink" href="#keypad2mqtt" title="Link to this heading">¶</a></h3>
<p>Python program interfacing the keypad with Home Assistant. It is installed on the Raspberry pi and runs as a service.</p>
<p><a class="reference external" href="https://github.com/jrobichaud/keypad2mqtt">sources</a></p>
<section id="id5">
<h4>Installing the program<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:jrobichaud/keypad2mqtt.git
<span class="nb">cd</span><span class="w"> </span>keypad2mqtt
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</section>
<section id="id6">
<h4>Running the program<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<p>Make sure to change the arguments to match your mqtt broker configuration.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;keypad2mqtt&quot;</span><span class="w"> </span><span class="s2">&quot;&lt;homeassistant url&gt;&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;ZiddyMakes ZMK_16_KEY&quot;</span><span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;&lt;mqtt user&gt;&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;&lt;mqtt password&gt;&quot;</span>
</pre></div>
</div>
</section>
<section id="id7">
<h4>Service configuration<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">keypad2mqtt</span>
<span class="na">Documentation</span><span class="o">=</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">User</span><span class="o">=</span><span class="s">retro</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/python3 -m &quot;keypad2mqtt&quot; &quot;&lt;homeassistant url&gt;&quot; -d &quot;ZiddyMakes ZMK_16_KEY&quot; -u &quot;&lt;mqtt user&gt;&quot; -p &quot;&lt;mqtt password&gt;&quot;</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">MemorySwapMax</span><span class="o">=</span><span class="s">0</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
</section>
</section>
<section id="home-assistant-configuration">
<h3>Home Assistant configuration<a class="headerlink" href="#home-assistant-configuration" title="Link to this heading">¶</a></h3>
<p>Create an Home Assistant automation for each key using a MQTT trigger for each topic.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">trigger</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mqtt</span>
<span class="w">    </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keypad/F1</span>
</pre></div>
</div>
</section>
<section id="other-configurations">
<h3>Other configurations<a class="headerlink" href="#other-configurations" title="Link to this heading">¶</a></h3>
<section id="turn-off-wifi-power-saving-mode-on-the-raspberry-pi">
<h4>Turn off wifi power saving mode on the raspberry pi<a class="headerlink" href="#turn-off-wifi-power-saving-mode-on-the-raspberry-pi" title="Link to this heading">¶</a></h4>
<p>I was losing the wifi connection intermittently on the raspberry pi. I turned off the power saving <a class="reference external" href="https://unix.stackexchange.com/a/315400/275498">Turning off wifi power saving</a>.</p>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">My Retrogaming Setup</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="infrared.html">Infrared</a></li>
<li class="toctree-l1"><a class="reference internal" href="keypad.html">Keypad v2</a></li>
<li class="toctree-l1"><a class="reference internal" href="cec.html">CEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="power.html">Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="cast.html">Cast</a></li>
<li class="toctree-l1"><a class="reference internal" href="homeassistant.html">Home Assistant</a></li>
<li class="toctree-l1"><a class="reference internal" href="alttpr.html">A Link to the Past Randomizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="products.html">Products Used</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Graveyard</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cec-through-raspberry-pi">CEC through Raspberry PI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#infrared-through-arduino">Infrared through Arduino</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keypad-v1">Keypad v1</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="products.html" title="previous chapter">Products Used</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jules Robichaud-Gagnon.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/obsoletes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>