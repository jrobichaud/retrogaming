<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CEC &#8212; My Retrogaming Setup 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=1bc0af66" />
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Power" href="power.html" />
    <link rel="prev" title="Keypad v2" href="keypad.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="cec">
<span id="id1"></span><h1>CEC<a class="headerlink" href="#cec" title="Link to this heading">¶</a></h1>
<p>CEC is a feature of HDMI that allows individual CEC-enabled devices to control each other without user intervention.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>I use CEC protocol control my TV with Home Assistant. Ex: Turn on/off TV, change input source, and control volume.</p>
<p>I first used a Raspberry PI to control the TV but I wanted to move to an ESP32 because the Raspberry pi was not reliable enough (See <a class="reference internal" href="obsoletes.html#cec-rpi"><span class="std std-ref">CEC through Raspberry PI</span></a>).</p>
<p>I do not have any spare HDMI ports so I needed to create a CEC proxy between my TV and another device. In my case the Raspberry PI already plugged to my TV. The video and audio still need to pass through.</p>
<div class="graphviz"><object data="_images/graphviz-1ff641d61122bd8ab656526997e8ff28efcbe079.svg" type="image/svg+xml" class="graphviz">
<p class="warning">// https://stackoverflow.com/a/59363959/2115513
digraph SEQ_DIAGRAM {
    graph [overlap = true, splines = line, nodesep = 1.0, ordering = out];
    edge [arrowhead = none];
    node [shape = none, width = 0, height = 0, label = &quot;&quot;];

    {
        rank = same;
        node [shape = rectangle, height = 0.7, width = 2];
        pi [label = &quot;Raspberry Pi&quot;];
        homeassistant [label = &quot;Home Assistant&quot;];
        cec [label = &quot;cec proxy (ESP device)&quot;];
        tv [label = &quot;TV&quot;]
    }
    // Draw vertical lines
    {
        edge [style = dashed, weight = 6];
        pi -&gt; a1 -&gt; a2 -&gt; a3 -&gt; a4 -&gt; a5;
    }
    {
        edge [style = dashed, weight = 6];
        homeassistant -&gt; b1 -&gt; b2 -&gt; b3;
        b3 -&gt; b4 -&gt; b5;
    }
    {
        edge [style = dashed, weight = 6];
        cec -&gt; c1
        c1 -&gt; c2 [penwidth = 5, style = solid];
        c2 -&gt; c3 -&gt; c4 -&gt; c5;
    }
    {
        edge [style = dashed, weight = 6];
        tv -&gt; d1;
        d1 -&gt; d2;
        d2 -&gt; d3 [penwidth = 5, style = solid, label=&quot;changes to HDMI1&quot;];
        d3 -&gt; d4 -&gt; d5;
    }
    { rank = same; b1 -&gt; c1 [label = &quot;send message via WIFI to proxy\nEx: 1f:82:10:00&quot;, arrowhead = normal]; }
    { rank = same; c2 -&gt; d2 [label = &quot;HDMI pin13: relay message to TV&quot;, arrowhead = normal]; }
    { rank = same;
        a4 -&gt; b4;
        b4 -&gt; c4;
        c4 -&gt; d4 [label =&quot;rest of the HDMI pins (audio, video, etc.)&quot;, arrowhead = normal];
    }

}</p></object></div>
</section>
<section id="esphome-configuration">
<span id="esp-home-cec"></span><h2>ESPHome configuration<a class="headerlink" href="#esphome-configuration" title="Link to this heading">¶</a></h2>
<img alt="CEC home assistant" class="align-center" src="_images/hdmi_cec_home_assistant.png" />
<p>I use this <a class="reference external" href="https://github.com/Palakis/esphome-native-hdmi-cec">ESPHome external component “Palakis/esphome-native-hdmi-cec”</a> to control CEC with Homeassistant through ESPHome.</p>
<p>I used <a class="reference external" href="https://cec-o-matic.com/">CEC-O-Matic</a> to determine the cec DATA for my TV.</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">CEC messages for my TV</span><a class="headerlink" href="#id2" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Action</p></th>
<th class="head"><p>Message</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Power on</p></td>
<td><p>10:04</p></td>
</tr>
<tr class="row-odd"><td><p>Standby</p></td>
<td><p>10:36</p></td>
</tr>
<tr class="row-even"><td><p>Change source 1</p></td>
<td><p>1f:82:10:00</p></td>
</tr>
<tr class="row-odd"><td><p>Change source 2</p></td>
<td><p>1f:82:20:00</p></td>
</tr>
<tr class="row-even"><td><p>Change source 3</p></td>
<td><p>1f:82:30:00</p></td>
</tr>
<tr class="row-odd"><td><p>Volume up</p></td>
<td><p>10:44:41:00</p></td>
</tr>
<tr class="row-even"><td><p>Volume down</p></td>
<td><p>10:44:42:00</p></td>
</tr>
</tbody>
</table>
<p>With this configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">substitutions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;esphome-retro-cec&quot;</span>
<span class="w">  </span><span class="nt">friendly_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ESPHome Retro CEC</span>

<span class="nt">esphome</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${name}</span>
<span class="w">  </span><span class="nt">friendly_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${friendly_name}</span>
<span class="w">  </span><span class="nt">name_add_mac_suffix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">platformio_options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">board_build.flash_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dio</span>
<span class="w">  </span><span class="nt">project</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esphome.web</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>

<span class="nt">esp32</span><span class="p">:</span>
<span class="w">  </span><span class="nt">board</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp32-s3-devkitc-1</span>
<span class="w">  </span><span class="nt">framework</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp-idf</span>

<span class="c1"># Enable logging</span>
<span class="nt">logger</span><span class="p">:</span>

<span class="c1"># Enable Home Assistant API</span>
<span class="nt">api</span><span class="p">:</span>
<span class="w">  </span><span class="nt">encryption</span><span class="p">:</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="kt">!secret</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esphome_encryption_key</span>

<span class="c1"># Allow Over-The-Air updates</span>
<span class="nt">ota</span><span class="p">:</span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esphome</span>

<span class="c1"># Allow provisioning Wi-Fi via serial</span>
<span class="nt">improv_serial</span><span class="p">:</span>

<span class="nt">wifi</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Set up a wifi access point</span>
<span class="w">  </span><span class="nt">ap</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="c1"># In combination with the `ap` this allows the user</span>
<span class="c1"># to provision wifi credentials to the device via WiFi AP.</span>
<span class="nt">captive_portal</span><span class="p">:</span>

<span class="nt">dashboard_import</span><span class="p">:</span>
<span class="w">  </span><span class="nt">package_import_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github://esphome/firmware/esphome-web/esp32s3.yaml@v2</span>
<span class="w">  </span><span class="nt">import_full_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># Sets up Bluetooth LE (Only on ESP32) to allow the user</span>
<span class="c1"># to provision wifi credentials to the device.</span>
<span class="nt">esp32_improv</span><span class="p">:</span>
<span class="w">  </span><span class="nt">authorizer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>

<span class="c1"># To have a &quot;next url&quot; for improv serial</span>
<span class="c1">#web_server: !remove</span>

<span class="nt">external_components</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github://Palakis/esphome-hdmi-cec</span>

<span class="nt">hdmi_cec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x01</span><span class="w"> </span><span class="c1"># Recorder</span>
<span class="w">  </span><span class="nt">physical_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3000</span>
<span class="w">  </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIO4</span>
<span class="w">  </span><span class="nt">osd_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;retro-cec&quot;</span>

<span class="nt">button</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TV Volume Up</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x0</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x44</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x41</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TV Volume Down</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x0</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x44</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x42</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Activate TV</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x0</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x04</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Standby TV</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x0</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x36</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Select Input 1 (hdmi switch)</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0xF</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x82</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x10</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x0</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Select Input 2 (Retrotink4k)</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0xF</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x82</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x20</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x0</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Select Input 3 (pi0)</span>
<span class="w">    </span><span class="nt">on_press</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hdmi_cec.send</span><span class="p">:</span>
<span class="w">          </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0xF</span>
<span class="w">          </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x82</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x30</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x0</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="prototype">
<h2>Prototype<a class="headerlink" href="#prototype" title="Link to this heading">¶</a></h2>
<p>I first made a prototype using <a class="reference internal" href="products.html#arduino-nano-esp32"><span class="std std-ref">esp32-s3</span></a> with an <a class="reference internal" href="products.html#hdmi-proto-board"><span class="std std-ref">HDMI proto board</span></a>.</p>
<ul class="simple">
<li><p>Pin 13 goes to GPIO4 on this ESP32 board (configurable).</p></li>
<li><p>Pin 17 goes to the ground on the ESP32 board.</p></li>
<li><p>PIN 18 goes to the 5V on the ESP32 board. Needed for the TV to detect the device.</p></li>
</ul>
<img alt="cec prototype" class="align-center" src="_images/hdmi_proto.jpg" />
<p>This proof of concept was working but it was not a man in the middle CEC adapter like I needed.</p>
</section>
<section id="real-board">
<h2>Real board<a class="headerlink" href="#real-board" title="Link to this heading">¶</a></h2>
<p>I use this useful <a class="reference external" href="hdmi_cec_adapter">female to male HDMI board</a> to plug inbetween my Raspberry PI and my TV.</p>
<p>We can solder wires on any of the pins which is perfect for my needs.</p>
<img alt="front cec board" class="align-center" src="_images/hdmi_board.jpg" />
<p>I cut the trace of pin 13 on the side of the Raspberry PI to avoid conflicts.</p>
<p>I then soldered a wire from pin 13 to GPIO04 and a wire from the pin 17 to the ground of the ESP32 board I used from the prototype (probably overkill).</p>
<p>I did not need to solder the 5V pin because the Raspberry PI is already providing the power.</p>
<img alt="back cec board" class="align-center" src="_images/hdmi_board_back.jpg" />
<p>I then used shrink tube to bind the two boards together.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">My Retrogaming Setup</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="infrared.html">Infrared</a></li>
<li class="toctree-l1"><a class="reference internal" href="keypad.html">Keypad v2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CEC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#esphome-configuration">ESPHome configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prototype">Prototype</a></li>
<li class="toctree-l2"><a class="reference internal" href="#real-board">Real board</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="power.html">Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="cast.html">Cast</a></li>
<li class="toctree-l1"><a class="reference internal" href="homeassistant.html">Home Assistant</a></li>
<li class="toctree-l1"><a class="reference internal" href="alttpr.html">A Link to the Past Randomizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="products.html">Products Used</a></li>
<li class="toctree-l1"><a class="reference internal" href="obsoletes.html">Graveyard</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="keypad.html" title="previous chapter">Keypad v2</a></li>
      <li>Next: <a href="power.html" title="next chapter">Power</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jules Robichaud-Gagnon.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/cec.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>